# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ LLM –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

## –û–±–∑–æ—Ä

–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç OpenRouter API –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ —Ä–∞–∑–ª–∏—á–Ω—ã–º LLM –º–æ–¥–µ–ª—è–º. OpenRouter –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –µ–¥–∏–Ω—ã–π API –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –º–æ–¥–µ–ª—è–º–∏ –æ—Ç —Ä–∞–∑–Ω—ã—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ (OpenAI, Anthropic, Google –∏ –¥—Ä.).

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ü–æ–ª—É—á–µ–Ω–∏–µ API –∫–ª—é—á–∞

1. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–∞ [openrouter.ai](https://openrouter.ai/)
2. –ü–æ–ª—É—á–µ–Ω–∏–µ API –∫–ª—é—á–∞ [Keys](https://openrouter.ai/keys)
3. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–ª—é—á (–Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å `sk-or-v1-`)

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–î–æ–±–∞–≤—å—Ç–µ –≤ `.env`:

```bash
# OpenRouter API Configuration
OPENROUTER_API_KEY=sk-or-v1-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

# –û—Å–Ω–æ–≤–Ω–∞—è –º–æ–¥–µ–ª—å (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–µ—Ä–≤–∞—è –∏–∑ —Å–ø–∏—Å–∫–∞)
OPENROUTER_MODEL=google/gemini-2.0-flash-exp:free

OPENROUTER_SITE_URL=http://localhost
OPENROUTER_SITE_NAME=Alfa
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–æ–¥–µ–ª–µ–π —Å fallback (—Å–º. [–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π](#–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ-–ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ-–º–æ–¥–µ–ª–µ–π))

### 3. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞

```bash
make restart
```

## –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π

### –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

–°–∏—Å—Ç–µ–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **–∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π fallback –º–µ—Ö–∞–Ω–∏–∑–º** –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏:

1. üìç **–û—Å–Ω–æ–≤–Ω–∞—è –º–æ–¥–µ–ª—å** - –ø–µ—Ä–≤–∞—è –ø–æ–ø—ã—Ç–∫–∞ —Å –≤—ã–±—Ä–∞–Ω–Ω–æ–π –º–æ–¥–µ–ª—å—é
2. üîÑ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π fallback** - –µ—Å–ª–∏ –æ—Å–Ω–æ–≤–Ω–∞—è –º–æ–¥–µ–ª—å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ (rate limit, timeout), —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ —Å–ª–µ–¥—É—é—â—É—é –º–æ–¥–µ–ª—å –∏–∑ —Å–ø–∏—Å–∫–∞
3. ‚úÖ **–£—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç** - –∫–∞–∫ —Ç–æ–ª—å–∫–æ –º–æ–¥–µ–ª—å –æ—Ç–≤–µ—á–∞–µ—Ç, —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

### –°–ø–∏—Å–æ–∫ –º–æ–¥–µ–ª–µ–π —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º–∏

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–∏—Å—Ç–µ–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ –±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –º–æ–¥–µ–ª–∏ (–≤ –ø–æ—Ä—è–¥–∫–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞):

```python
# –í alfa/settings.py
OPENROUTER_MODELS = [
    'google/gemini-2.0-flash-exp:free',              # 1. Gemini (Google) - –±—ã—Å—Ç—Ä–∞—è
    'qwen/qwen-2.5-72b-instruct:free',               # 2. Qwen - –º–æ—â–Ω–∞—è –∫–∏—Ç–∞–π—Å–∫–∞—è –º–æ–¥–µ–ª—å
    'mistralai/mistral-nemo:free',                   # 3. Mistral - —Ñ—Ä–∞–Ω—Ü—É–∑—Å–∫–∞—è –º–æ–¥–µ–ª—å
    'nousresearch/hermes-3-llama-3.1-405b:free',     # 4. Hermes - –Ω–∞ –±–∞–∑–µ Llama
    'qwen/qwen3-14b:free',                           # 5. Qwen 3
    'mistralai/mistral-small-3.1-24b-instruct:free', # 6. Mistral Small
    'google/gemma-3-4b-it:free',                     # 7. Gemma (Google)
]
```

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

- ‚úÖ **–í—ã—Å–æ–∫–∞—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å** - –µ—Å–ª–∏ –æ–¥–Ω–∞ –º–æ–¥–µ–ª—å –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω–∞, —Å–∏—Å—Ç–µ–º–∞ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ –¥—Ä—É–≥—É—é
- ‚úÖ **–ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å** - –≤ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –æ—Ç–≤–µ—Ç–∞ —É–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è, –∫–∞–∫–∞—è –º–æ–¥–µ–ª—å –æ—Ç–≤–µ—Ç–∏–ª–∞ –∏ —Å–∫–æ–ª—å–∫–æ –ø–æ–ø—ã—Ç–æ–∫ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ
- ‚úÖ **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** - –≤—Å–µ –ø–æ–ø—ã—Ç–∫–∏ –∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- ‚úÖ **–ë–µ–∑ –ø—Ä–æ—Å—Ç–æ–µ–≤** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–ª—É—á–∞—é—Ç –æ—Ç–≤–µ—Ç –¥–∞–∂–µ –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å –æ—Ç–¥–µ–ª—å–Ω—ã–º–∏ –º–æ–¥–µ–ª—è–º–∏

### –ü—Ä–∏–º–µ—Ä –ª–æ–≥–æ–≤

```
INFO     –ü–æ–ø—ã—Ç–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å –º–æ–¥–µ–ª—å—é google/gemini-2.0-flash-exp:free –¥–ª—è –¥–∏–∞–ª–æ–≥–∞ 1
WARNING  ‚úó Rate limit –¥–ª—è –º–æ–¥–µ–ª–∏ google/gemini-2.0-flash-exp:free
WARNING  Fallback –Ω–∞ –º–æ–¥–µ–ª—å qwen/qwen-2.5-72b-instruct:free –¥–ª—è –¥–∏–∞–ª–æ–≥–∞ 1
INFO     ‚úì –£—Å–ø–µ—à–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω –æ—Ç–≤–µ—Ç –¥–ª—è –¥–∏–∞–ª–æ–≥–∞ 1. –ú–æ–¥–µ–ª—å: qwen-2.5-72b, –¢–æ–∫–µ–Ω—ã: 245, –í—Ä–µ–º—è: 3.5—Å, –ü–æ–ø—ã—Ç–æ–∫: 2
```

### –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç–∞

–í –ø–æ–ª–µ `metadata` –∫–∞–∂–¥–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è —Ç–µ–ø–µ—Ä—å –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è:

```json
{
  "attempted_models": 2,      // –°–∫–æ–ª—å–∫–æ –º–æ–¥–µ–ª–µ–π –±—ã–ª–æ –ø–æ–ø—Ä–æ–±–æ–≤–∞–Ω–æ
  "fallback_used": true,      // –ë—ã–ª –ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω fallback
  "temperature": 0.7,
  "max_tokens": 3000
}
```

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

1. **LLMService** (`chat/services/llm_service.py`)
   - –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å OpenRouter API
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É –º–æ–¥–µ–ª—è–º–∏
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ (rate limit, timeout)
   - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –º–µ—Ç—Ä–∏–∫–∏

2. **PromptBuilder** (`chat/services/prompt_builder.py`)
   - –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –ø—Ä–æ–º–ø—Ç–æ–≤ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
   - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –±–∏–∑–Ω–µ—Å–∞
   - –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –¥–∏–∞–ª–æ–≥–∞

### –°–∏—Å—Ç–µ–º–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã

–î–ª—è –∫–∞–∂–¥–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–∏–∞–ª–æ–≥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç:

- **General** - –æ–±—â–∏–π –±–∏–∑–Ω–µ—Å-–∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç
- **Legal** - —é—Ä–∏–¥–∏—á–µ—Å–∫–∏–π –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç (—Å –¥–∏—Å–∫–ª–µ–π–º–µ—Ä–æ–º)
- **Marketing** - –º–∞—Ä–∫–µ—Ç–æ–ª–æ–≥ —Å —Ñ–æ–∫—É—Å–æ–º –Ω–∞ digital –∏ –ª–æ–∫–∞–ª—å–Ω–æ–µ –ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏–µ
- **Finance** - —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–π –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç –¥–ª—è –º–∞–ª–æ–≥–æ –±–∏–∑–Ω–µ—Å–∞
- **HR** - HR-–∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç
- **Operations** - –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç –ø–æ –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–æ–º—É —É–ø—Ä–∞–≤–ª–µ–Ω–∏—é

### –ö–æ–Ω—Ç–µ–∫—Å—Ç –±–∏–∑–Ω–µ—Å–∞

–ü—Ä–∏ –ø—Ä–∏–≤—è–∑–∫–µ –¥–∏–∞–ª–æ–≥–∞ –∫ –±–∏–∑–Ω–µ—Å—É, AI –ø–æ–ª—É—á–∞–µ—Ç:

```python
{
  "–ù–∞–∑–≤–∞–Ω–∏–µ": "–ö–æ—Ñ–µ–π–Ω—è –≠—Å–ø—Ä–µ—Å—Å–æ",
  "–¢–∏–ø": "–ö–∞—Ñ–µ/–ö–æ—Ñ–µ–π–Ω—è",
  "–ì–æ—Ä–æ–¥": "–ú–æ—Å–∫–≤–∞",
  "–û–ø–∏—Å–∞–Ω–∏–µ": "–£—é—Ç–Ω–∞—è –∫–æ—Ñ–µ–π–Ω—è –≤ —Ü–µ–Ω—Ç—Ä–µ –≥–æ—Ä–æ–¥–∞",
  "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤": 5,
  "–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è": "...",  # –∏–∑ BusinessProfile.business_context
  "–¢–æ–Ω –æ–±—â–µ–Ω–∏—è": "–¥—Ä—É–∂–µ–ª—é–±–Ω—ã–π"  # –∏–∑ BusinessProfile.ai_preferences
}
```

## –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### Rate Limit

–ï—Å–ª–∏ –ø—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤:

```python
{
  'content': '–ò–∑–≤–∏–Ω–∏—Ç–µ, —Å–µ–π—á–∞—Å —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —á–µ—Ä–µ–∑ –º–∏–Ω—É—Ç—É.',
  'model': 'error-fallback',
  'metadata': {
    'error': True,
    'error_type': 'rate_limit'
  }
}
```

### Timeout

–ü—Ä–∏ —Ç–∞–π–º–∞—É—Ç–µ –∑–∞–ø—Ä–æ—Å–∞:

```python
{
  'content': '–ò–∑–≤–∏–Ω–∏—Ç–µ, –∑–∞–ø—Ä–æ—Å –∑–∞–Ω—è–ª —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞—Ç—å –≤–æ–ø—Ä–æ—Å –±–æ–ª–µ–µ –∫—Ä–∞—Ç–∫–æ.',
  'model': 'error-fallback',
  'metadata': {
    'error': True,
    'error_type': 'timeout'
  }
}
```

### API Error

–ü—Ä–∏ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–π –æ—à–∏–±–∫–µ:

```python
{
  'content': '–ò–∑–≤–∏–Ω–∏—Ç–µ, –ø—Ä–æ–∏–∑–æ—à–ª–∞ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑ —á–µ—Ä–µ–∑ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥.',
  'model': 'error-fallback',
  'metadata': {
    'error': True,
    'error_type': 'api_error'
  }
}
```

## –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏

### Temperature

–£–ø—Ä–∞–≤–ª—è–µ—Ç –∫—Ä–µ–∞—Ç–∏–≤–Ω–æ—Å—Ç—å—é –æ—Ç–≤–µ—Ç–æ–≤ (0.0 - 1.0):

```python
llm_service.generate_response(
    conversation=conversation,
    user_message=user_message,
    temperature=0.7  # –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é
)
```

- `0.0-0.3` - –±–æ–ª–µ–µ –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ, —Ç–æ—á–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã (–¥–ª—è —Ñ–∏–Ω–∞–Ω—Å–æ–≤, —é—Ä–∏–¥–∏–∫–∏)
- `0.4-0.7` - —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
- `0.8-1.0` - –±–æ–ª–µ–µ –∫—Ä–µ–∞—Ç–∏–≤–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã (–¥–ª—è –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–∞, –∏–¥–µ–π)

### Max Tokens

–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –æ—Ç–≤–µ—Ç–∞:

```python
llm_service.generate_response(
    conversation=conversation,
    user_message=user_message,
    max_tokens=4000  # –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é
)
```

- `1000` - –∫–æ—Ä–æ—Ç–∫–∏–µ –æ—Ç–≤–µ—Ç—ã
- `3000` - –ø–æ–ª–Ω—ã–µ, –¥–µ—Ç–∞–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
- `4000+` - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –¥–ª–∏–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### –õ–æ–≥–∏

–í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∫ LLM –ª–æ–≥–∏—Ä—É—é—Ç—Å—è:

```python
logger.info(
    f"–£—Å–ø–µ—à–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω –æ—Ç–≤–µ—Ç –¥–ª—è –¥–∏–∞–ª–æ–≥–∞ {conversation.id}. "
    f"–ú–æ–¥–µ–ª—å: {model_used}, –¢–æ–∫–µ–Ω—ã: {tokens_used}, –í—Ä–µ–º—è: {response_time:.2f}—Å"
)
```

### –ú–µ—Ç—Ä–∏–∫–∏

–ö–∞–∂–¥—ã–π –æ—Ç–≤–µ—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –º–µ—Ç—Ä–∏–∫–∏:

```python
{
  'model': 'deepseek/deepseek-r1:free',
  'tokens_used': 180,  # –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–∫–µ–Ω–æ–≤
  'response_time': 3.2,  # –í—Ä–µ–º—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
  'metadata': {
    'temperature': 0.7,
    'max_tokens': 1000,
    'finish_reason': 'stop'  # –∏–ª–∏ 'length', 'content_filter'
  }
}
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### Unit —Ç–µ—Å—Ç—ã

```bash
python manage.py test chat.tests.MessageAPITest
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —Ä–µ–∞–ª—å–Ω—ã–º LLM

```bash
# –í Django shell
python manage.py shell

from chat.models import Conversation, Message
from chat.services import LLMService
from users.models import User

user = User.objects.first()
conversation = Conversation.objects.create(
    user=user,
    category='marketing'
)

user_message = Message.objects.create(
    conversation=conversation,
    role='user',
    content='–ö–∞–∫ —É–≤–µ–ª–∏—á–∏—Ç—å –ø—Ä–æ–¥–∞–∂–∏?'
)

llm_service = LLMService()
response = llm_service.generate_response(conversation, user_message)

print(response['content'])
```